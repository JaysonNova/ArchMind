# 前端架构详细设计文档

## 文档版本信息

* **版本：** v1.0
* **创建日期：** 2026-02-01
* **最后更新：** 2026-02-01
* **文档状态：** Draft
* **基于文档：** 架构设计文档 v1.0

---

## 1. 文档概述

### 1.1 文档目的

本文档详细描述 ArchMind AI 前端架构的实现规范，包括:
- Vue 组件设计
- Pinia 状态管理
- Composables 设计
- 页面路由设计
- UI 组件库使用

### 1.2 目标读者

- 前端开发工程师
- UI/UX 设计师
- 全栈开发工程师

### 1.3 技术栈

- **框架:** Nuxt 3 + Vue 3 (Composition API)
- **语言:** TypeScript 5.x
- **UI 库:** shadcn/ui (Vue) + Tailwind CSS (PRIMARY, MANDATORY)
- **状态管理:** Pinia
- **表单验证:** VeeValidate + Zod
- **HTTP 客户端:** Nuxt 内置 $fetch
- **图标库:** Lucide Vue Next

**CRITICAL: UI Library Standards**

本项目**严格使用 shadcn/ui** 作为唯一的 UI 组件库。这是强制性要求：

- ✅ **必须使用:** shadcn/ui 组件
- ❌ **严禁使用:** Nuxt UI, PrimeVue, Element Plus, 或任何其他 UI 库
- ❌ **严禁混用:** 多个 UI 库

详细规范请参阅：
- `/docs/SHADCN_DESIGN_STANDARDS.md` - 完整的 shadcn/ui 设计规范
- `/docs/SHADCN_USAGE.md` - shadcn/ui 使用指南
- `/CLAUDE.md` - 项目级别的 UI 开发标准

---

## 2. UI 组件库规范 (shadcn/ui)

### 2.1 核心原则

**强制性要求：本项目只使用 shadcn/ui 作为 UI 组件库。**

#### 2.1.1 为什么选择 shadcn/ui

1. **代码所有权** - 组件复制到项目中，完全可控
2. **无版本锁定** - 不是 npm 依赖，避免版本冲突
3. **类型安全** - 完整 TypeScript 支持
4. **可访问性优先** - 基于 Radix Vue，符合 WCAG 标准
5. **Tailwind 原生集成** - 完美配合设计系统
6. **灵活定制** - 可自由修改任何组件

#### 2.1.2 组件安装

```bash
# 添加单个组件
pnpm dlx shadcn-vue@latest add button

# 添加多个组件
pnpm dlx shadcn-vue@latest add button card dialog input

# 项目必需组件（按优先级）
pnpm dlx shadcn-vue@latest add button input label textarea
pnpm dlx shadcn-vue@latest add card separator tabs
pnpm dlx shadcn-vue@latest add dialog alert toast progress
pnpm dlx shadcn-vue@latest add select checkbox radio-group switch
pnpm dlx shadcn-vue@latest add table badge avatar
pnpm dlx shadcn-vue@latest add dropdown-menu navigation-menu breadcrumb
```

#### 2.1.3 导入规范

```typescript
// ✅ 正确的导入方式
import { Button } from '~/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '~/components/ui/card'
import { Dialog, DialogContent, DialogTrigger } from '~/components/ui/dialog'
import { cn } from '~/lib/utils'

// ❌ 禁止的导入方式
import { UButton } from '#components'  // Nuxt UI
import { PButton } from 'primevue/button'  // PrimeVue
```

### 2.2 组件使用模式

#### 2.2.1 按钮组件

```vue
<script setup lang="ts">
import { Button } from '~/components/ui/button'
</script>

<template>
  <!-- 变体 -->
  <Button variant="default">默认</Button>
  <Button variant="destructive">删除</Button>
  <Button variant="outline">轮廓</Button>
  <Button variant="ghost">幽灵</Button>
  <Button variant="link">链接</Button>

  <!-- 尺寸 -->
  <Button size="sm">小</Button>
  <Button size="default">默认</Button>
  <Button size="lg">大</Button>
  <Button size="icon">
    <Icon name="lucide:search" />
  </Button>

  <!-- 带图标 -->
  <Button>
    <Icon name="lucide:plus" class="mr-2 h-4 w-4" />
    添加项目
  </Button>
</template>
```

#### 2.2.2 卡片组件

```vue
<script setup lang="ts">
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '~/components/ui/card'
import { Button } from '~/components/ui/button'
</script>

<template>
  <Card>
    <CardHeader>
      <CardTitle>卡片标题</CardTitle>
      <CardDescription>卡片描述信息</CardDescription>
    </CardHeader>
    <CardContent>
      <p>卡片主要内容</p>
    </CardContent>
    <CardFooter>
      <Button>操作按钮</Button>
    </CardFooter>
  </Card>
</template>
```

#### 2.2.3 对话框组件

```vue
<script setup lang="ts">
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger
} from '~/components/ui/dialog'
import { Button } from '~/components/ui/button'

const open = ref(false)
</script>

<template>
  <Dialog v-model:open="open">
    <DialogTrigger as-child>
      <Button>打开对话框</Button>
    </DialogTrigger>
    <DialogContent>
      <DialogHeader>
        <DialogTitle>对话框标题</DialogTitle>
        <DialogDescription>对话框描述</DialogDescription>
      </DialogHeader>
      <div class="py-4">
        <!-- 对话框内容 -->
      </div>
      <DialogFooter>
        <Button variant="outline" @click="open = false">取消</Button>
        <Button @click="open = false">确认</Button>
      </DialogFooter>
    </DialogContent>
  </Dialog>
</template>
```

### 2.3 样式定制规范

#### 2.3.1 使用 Tailwind CSS 类名

```vue
<template>
  <!-- ✅ 正确 - 使用 Tailwind 类名 -->
  <Button class="w-full mt-4">全宽按钮</Button>
  <Card class="max-w-md mx-auto shadow-lg">内容</Card>

  <!-- ❌ 错误 - 不要使用内联样式 -->
  <Button style="width: 100%; margin-top: 16px;">错误</Button>
</template>
```

#### 2.3.2 使用 cn() 工具函数

```vue
<script setup lang="ts">
import { Button } from '~/components/ui/button'
import { cn } from '~/lib/utils'

const isActive = ref(false)
const isDisabled = ref(false)
</script>

<template>
  <Button
    :class="cn(
      'w-full',
      isActive && 'bg-primary',
      isDisabled && 'opacity-50 cursor-not-allowed'
    )"
  >
    动态样式按钮
  </Button>
</template>
```

#### 2.3.3 主题定制

通过修改 `assets/css/main.css` 中的 CSS 变量：

```css
@layer base {
  :root {
    --primary: 221.2 83.2% 53.3%;  /* 主色调 */
    --destructive: 0 84.2% 60.2%;  /* 危险色 */
    --border: 214.3 31.8% 91.4%;   /* 边框色 */
    /* ... 更多变量 */
  }

  .dark {
    --primary: 217.2 91.2% 59.8%;
    /* ... 暗色模式变量 */
  }
}
```

### 2.4 代码审查清单

提交前必须确认：

- [ ] 所有 UI 组件都使用 shadcn/ui
- [ ] 没有从其他 UI 库导入组件
- [ ] 正确使用 `~/components/ui/*` 导入路径
- [ ] 使用 Tailwind CSS 类名而非内联样式
- [ ] 使用 `cn()` 函数处理条件类名
- [ ] 遵循 shadcn/ui 命名约定
- [ ] 保留可访问性属性
- [ ] TypeScript 类型正确定义

---

## 3. 页面路由设计

### 2.1 路由结构

**文件路由 (Nuxt 3 约定):**
```
pages/
├── index.vue                 # 首页/仪表板
├── documents/
│   ├── index.vue             # 文档列表
│   └── [id].vue              # 文档详情
├── generate.vue              # PRD 生成
└── settings.vue              # 系统设置
```

### 2.2 首页设计

**文件:** `pages/index.vue`

```vue
<template>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">ArchMind AI</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- 统计卡片 - 使用 shadcn/ui Card -->
      <Card>
        <CardHeader class="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle class="text-sm font-medium">文档总数</CardTitle>
          <Icon name="lucide:file-text" class="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div class="text-2xl font-bold">{{ stats.documentCount }}</div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader class="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle class="text-sm font-medium">PRD 总数</CardTitle>
          <Icon name="lucide:file-stack" class="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div class="text-2xl font-bold">{{ stats.prdCount }}</div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader class="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle class="text-sm font-medium">向量总数</CardTitle>
          <Icon name="lucide:database" class="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div class="text-2xl font-bold">{{ stats.vectorCount }}</div>
        </CardContent>
      </Card>
    </div>

    <!-- 快速操作 -->
    <div class="mt-8">
      <h2 class="text-2xl font-semibold mb-4">快速操作</h2>
      <div class="flex gap-4">
        <Button variant="outline" size="lg" as-child>
          <NuxtLink to="/documents">
            <Icon name="lucide:folder-open" class="mr-2 h-5 w-5" />
            管理文档
          </NuxtLink>
        </Button>
        <Button size="lg" as-child>
          <NuxtLink to="/generate">
            <Icon name="lucide:sparkles" class="mr-2 h-5 w-5" />
            生成 PRD
          </NuxtLink>
        </Button>
      </div>
    </div>

    <!-- 最近文档 -->
    <div class="mt-8">
      <h2 class="text-2xl font-semibold mb-4">最近文档</h2>
      <DocumentList :documents="recentDocuments" :limit="5" />
    </div>
  </div>
</template>

<script setup lang="ts">
import { Card, CardContent, CardHeader, CardTitle } from '~/components/ui/card'
import { Button } from '~/components/ui/button'

const stats = ref({
  documentCount: 0,
  prdCount: 0,
  vectorCount: 0,
})

const recentDocuments = ref([])

onMounted(async () => {
  // 加载统计数据
  const { data } = await $fetch('/api/stats')
  stats.value = data

  // 加载最近文档
  const { data: docs } = await $fetch('/api/documents', {
    query: { limit: 5 },
  })
  recentDocuments.value = docs.documents
})
</script>
```

---

## 3. 组件设计

**重要提醒：所有组件必须使用 shadcn/ui。参考 `/docs/SHADCN_DESIGN_STANDARDS.md` 获取完整规范。**

### 3.1 文档上传组件

**文件:** `components/documents/DocumentUpload.vue`

```vue
<template>
  <Card class="w-full">
    <CardHeader>
      <CardTitle>上传文档</CardTitle>
      <CardDescription>支持 PDF, DOCX, Markdown 格式，最大 10MB</CardDescription>
    </CardHeader>
    <CardContent>
      <div
        :class="cn(
          'border-2 border-dashed rounded-lg p-8 text-center transition-colors',
          isDragging ? 'border-primary bg-primary/5' : 'border-border',
          'hover:border-primary/50'
        )"
        @dragover.prevent="isDragging = true"
        @dragleave.prevent="isDragging = false"
        @drop.prevent="handleDrop"
      >
        <input
          ref="fileInput"
          type="file"
          accept=".pdf,.docx,.md,.markdown"
          class="hidden"
          @change="handleFileSelect"
        />

        <div v-if="!uploading" class="space-y-4">
          <Icon name="lucide:cloud-upload" class="w-12 h-12 mx-auto text-muted-foreground" />
          <div class="space-y-2">
            <p class="text-sm text-muted-foreground">拖拽文件到此处或</p>
            <Button @click="fileInput?.click()" variant="outline">
              <Icon name="lucide:file-plus" class="mr-2 h-4 w-4" />
              选择文件
            </Button>
          </div>
          <p class="text-xs text-muted-foreground">
            支持 PDF, DOCX, Markdown • 最大 10MB
          </p>
        </div>

        <div v-else class="space-y-4">
          <Progress :value="uploadProgress" class="w-full" />
          <p class="text-sm text-muted-foreground">
            上传中... {{ uploadProgress }}%
          </p>
        </div>
      </div>

      <Alert v-if="error" variant="destructive" class="mt-4">
        <Icon name="lucide:alert-circle" class="h-4 w-4" />
        <AlertTitle>上传失败</AlertTitle>
        <AlertDescription>{{ error }}</AlertDescription>
      </Alert>

      <Alert v-if="success" class="mt-4">
        <Icon name="lucide:check-circle" class="h-4 w-4" />
        <AlertTitle>上传成功</AlertTitle>
        <AlertDescription>文档已成功上传并开始处理</AlertDescription>
      </Alert>
    </CardContent>
  </Card>
</template>

<script setup lang="ts">
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '~/components/ui/card'
import { Button } from '~/components/ui/button'
import { Progress } from '~/components/ui/progress'
import { Alert, AlertDescription, AlertTitle } from '~/components/ui/alert'
import { cn } from '~/lib/utils'

const fileInput = ref<HTMLInputElement>()
const uploading = ref(false)
const uploadProgress = ref(0)
const error = ref('')
const success = ref(false)
const isDragging = ref(false)

const emit = defineEmits<{
  uploaded: [documentId: string]
}>()

async function handleFileSelect(event: Event) {
  const target = event.target as HTMLInputElement
  const file = target.files?.[0]
  if (file) {
    await uploadFile(file)
  }
}

async function handleDrop(event: DragEvent) {
  isDragging.value = false
  const file = event.dataTransfer?.files[0]
  if (file) {
    await uploadFile(file)
  }
}

async function uploadFile(file: File) {
  error.value = ''
  success.value = false
  uploading.value = true
  uploadProgress.value = 0

  try {
    const formData = new FormData()
    formData.append('file', file)

    const { data } = await $fetch('/api/documents/upload', {
      method: 'POST',
      body: formData,
      onUploadProgress: (progress) => {
        uploadProgress.value = Math.round((progress.loaded / progress.total) * 100)
      },
    })

    success.value = true
    emit('uploaded', data.id)
  } catch (err: any) {
    error.value = err.message || '上传失败，请重试'
  } finally {
    uploading.value = false
    uploadProgress.value = 0
  }
}
</script>
```

### 3.2 文档列表组件

**文件:** `components/documents/DocumentList.vue`

```vue
<template>
  <Card>
    <CardHeader>
      <div class="flex items-center justify-between">
        <div>
          <CardTitle>文档列表</CardTitle>
          <CardDescription>共 {{ documents.length }} 个文档</CardDescription>
        </div>
        <Button @click="emit('refresh')">
          <Icon name="lucide:refresh-cw" class="mr-2 h-4 w-4" />
          刷新
        </Button>
      </div>
    </CardHeader>
    <CardContent>
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>名称</TableHead>
            <TableHead>类型</TableHead>
            <TableHead>状态</TableHead>
            <TableHead>创建时间</TableHead>
            <TableHead class="text-right">操作</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          <TableRow v-for="doc in documents" :key="doc.id">
            <TableCell class="font-medium">
              <div class="flex items-center gap-2">
                <Icon :name="getFileIcon(doc.type)" class="h-4 w-4 text-muted-foreground" />
                {{ doc.name }}
              </div>
            </TableCell>
            <TableCell>
              <Badge variant="outline">{{ doc.type }}</Badge>
            </TableCell>
            <TableCell>
              <Badge :variant="getStatusVariant(doc.status)">
                {{ doc.status }}
              </Badge>
            </TableCell>
            <TableCell>{{ formatDate(doc.createdAt) }}</TableCell>
            <TableCell class="text-right">
              <DropdownMenu>
                <DropdownMenuTrigger as-child>
                  <Button variant="ghost" size="sm">
                    <Icon name="lucide:more-horizontal" class="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent align="end">
                  <DropdownMenuItem @click="emit('view', doc.id)">
                    <Icon name="lucide:eye" class="mr-2 h-4 w-4" />
                    查看
                  </DropdownMenuItem>
                  <DropdownMenuItem @click="emit('edit', doc.id)">
                    <Icon name="lucide:edit" class="mr-2 h-4 w-4" />
                    编辑
                  </DropdownMenuItem>
                  <DropdownMenuSeparator />
                  <DropdownMenuItem @click="handleDelete(doc.id)" class="text-destructive">
                    <Icon name="lucide:trash-2" class="mr-2 h-4 w-4" />
                    删除
                  </DropdownMenuItem>
                </DropdownMenuContent>
              </DropdownMenu>
            </TableCell>
          </TableRow>
        </TableBody>
      </Table>
    </CardContent>
  </Card>
</template>

<script setup lang="ts">
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '~/components/ui/card'
import { Button } from '~/components/ui/button'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '~/components/ui/table'
import { Badge } from '~/components/ui/badge'
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '~/components/ui/dropdown-menu'

interface Document {
  id: string
  name: string
  type: string
  status: 'active' | 'archived' | 'processing'
  createdAt: string
}

interface Props {
  documents: Document[]
  limit?: number
}

const props = defineProps<Props>()

const emit = defineEmits<{
  view: [id: string]
  edit: [id: string]
  delete: [id: string]
  refresh: []
}>()

function getFileIcon(type: string) {
  const icons: Record<string, string> = {
    pdf: 'lucide:file-text',
    docx: 'lucide:file-text',
    md: 'lucide:file-code',
    markdown: 'lucide:file-code',
  }
  return icons[type.toLowerCase()] || 'lucide:file'
}

function getStatusVariant(status: string) {
  const variants: Record<string, string> = {
    active: 'default',
    archived: 'secondary',
    processing: 'outline',
  }
  return variants[status] || 'default'
}

function formatDate(dateString: string) {
  return new Date(dateString).toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })
}

async function handleDelete(id: string) {
  // 显示确认对话框
  if (confirm('确定要删除这个文档吗？')) {
    emit('delete', id)
  }
}
</script>
```

## 4. 状态管理 (Pinia)

### 4.1 文档状态管理

**文件:** `stores/documents.ts`

```typescript
import { defineStore } from 'pinia';
import type { Document } from '@/types/document';

export const useDocumentsStore = defineStore('documents', () => {
  const documents = ref<Document[]>([]);
  const loading = ref(false);
  const error = ref<string | null>(null);

  async function fetchDocuments() {
    loading.value = true;
    error.value = null;

    try {
      const { data } = await $fetch('/api/documents');
      documents.value = data.documents;
    } catch (err: any) {
      error.value = err.message;
    } finally {
      loading.value = false;
    }
  }

  async function uploadDocument(file: File) {
    const formData = new FormData();
    formData.append('file', file);

    const { data } = await $fetch('/api/documents/upload', {
      method: 'POST',
      body: formData,
    });

    documents.value.unshift(data);
    return data;
  }

  async function deleteDocument(id: string) {
    await $fetch(`/api/documents/${id}`, { method: 'DELETE' });
    documents.value = documents.value.filter(d => d.id !== id);
  }

  return {
    documents,
    loading,
    error,
    fetchDocuments,
    uploadDocument,
    deleteDocument,
  };
});
```

---

## 5. Composables 设计

### 5.1 PRD 生成 Composable

**文件:** `composables/usePrdGenerator.ts`

```typescript
export function usePrdGenerator() {
  const generating = ref(false);
  const content = ref('');
  const error = ref<string | null>(null);

  async function generate(userInput: string, options?: any) {
    generating.value = true;
    error.value = null;
    content.value = '';

    try {
      const { data } = await $fetch('/api/ai/generate', {
        method: 'POST',
        body: { userInput, ...options },
      });

      content.value = data.content;
      return data;
    } catch (err: any) {
      error.value = err.message;
      throw err;
    } finally {
      generating.value = false;
    }
  }

  async function* generateStream(userInput: string, options?: any) {
    generating.value = true;
    error.value = null;
    content.value = '';

    try {
      const response = await fetch('/api/ai/stream', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userInput, ...options }),
      });

      const reader = response.body?.getReader();
      const decoder = new TextDecoder();

      if (!reader) throw new Error('No response body');

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = JSON.parse(line.slice(6));
            if (data.chunk) {
              content.value += data.chunk;
              yield data.chunk;
            }
            if (data.done) return;
          }
        }
      }
    } catch (err: any) {
      error.value = err.message;
      throw err;
    } finally {
      generating.value = false;
    }
  }

  return {
    generating,
    content,
    error,
    generate,
    generateStream,
  };
}
```

---

## 6. 总结

本文档详细描述了 ArchMind AI 前端架构的完整实现规范，包括:

✅ **UI 组件库规范** - 严格使用 shadcn/ui，禁止混用其他库
✅ **页面路由设计** - Nuxt 3 文件路由
✅ **组件设计** - 文档上传、列表、PRD 生成（基于 shadcn/ui）
✅ **状态管理** - Pinia stores
✅ **Composables** - 可复用的业务逻辑
✅ **样式系统** - Tailwind CSS + CSS 变量

**关键设计决策:**
- Vue 3 Composition API
- TypeScript 类型安全
- **shadcn/ui 作为唯一 UI 组件库（强制性）**
- Pinia 状态管理
- Composables 封装业务逻辑
- Tailwind CSS 样式系统

**重要文档参考：**
- `/docs/SHADCN_DESIGN_STANDARDS.md` - shadcn/ui 完整设计规范（必读）
- `/docs/SHADCN_USAGE.md` - shadcn/ui 使用指南
- `/CLAUDE.md` - 项目级别开发标准

**UI 开发强制要求：**
1. ✅ 只使用 shadcn/ui 组件
2. ❌ 禁止使用 Nuxt UI、PrimeVue 或其他 UI 库
3. ❌ 禁止混用多个 UI 库
4. ✅ 使用 Tailwind CSS 进行样式定制
5. ✅ 使用 `cn()` 工具函数合并类名
6. ✅ 保持组件的可访问性标准

---

## 完整模块化详细设计文档总结

我已经为 ArchMind AI 项目创建了 **6 个独立的模块化详细设计文档**:

1. ✅ **数据层详细设计** (`01-数据层详细设计.md`)
   - 数据库 Schema 设计
   - DAO 层实现
   - TypeScript 类型定义
   - 向量数据库集成

2. ✅ **RAG 引擎详细设计** (`02-RAG引擎详细设计.md`)
   - 文档加载器
   - 文本分块器
   - 向量化服务
   - 语义检索器

3. ✅ **AI 服务层详细设计** (`03-AI服务层详细设计.md`)
   - 统一模型接口
   - Claude/OpenAI 适配器
   - 模型管理器
   - 智能路由策略

4. ✅ **PRD 生成引擎详细设计** (`04-PRD生成引擎详细设计.md`)
   - Prompt 工程
   - PRD 生成器
   - 后处理器
   - 流式输出

5. ✅ **API 层详细设计** (`05-API层详细设计.md`)
   - RESTful API 接口
   - 文档管理 API
   - RAG 检索 API
   - AI 生成 API

6. ✅ **前端架构详细设计** (`06-前端架构详细设计.md`)
   - 页面路由设计
   - Vue 组件设计
   - Pinia 状态管理
   - Composables 设计

所有文档都已创建在 `docs/详细设计/` 目录下，每个模块独立成文档，便于开发人员按模块查阅和实施。

